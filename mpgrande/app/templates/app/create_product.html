{% extends 'base/sidebar.html' %}

{% block content %} 

<body>
    <h2>Crear Producto </h2>
        <form method="POST" class="container2">
            <div class="form1">
                {% csrf_token %}
                {{ from_producto}}

                <input class="button" type="submit" value="Crear producto">
                <h2 class="reg-prod">Mis Productos</h2>
            </div>
            <script>
                function eliminarProducto(id){
                    Swal.fire({
                    "title": '¿Estás seguro?',
                    "text": "Una vez borrado no se podrá recuperar",
                    "icon": 'warning ',
                    "showCancelButton": true,
                    "confirmButtonColor": '#3085d6',
                    "cancelButtonColor": '#d33',
                    "cancelButtonText":"No, Cancelar", 
                    "confirmButtonText": 'Si, Eliminar',
                    "reverseButtons":true  
            
                    }).then(function(result) {
                        if (result.isConfirmed) {
                        window.location.href = "/delete_product/"+id+"/"
                    }
                    })
            
                }
            
            </script>
            <table  class="form1" >
                <thead>
                    <tr>
                        <th>id</th>
                        <th>Nombre</th>
                        <th>Origen</th>
                        <th>Precio </th>
                        <th>Estado</th>
                        <th>Usuario</th>
                        <th>Opciones</th>
                    </tr>
                </thead>
                {% if productos  %}    
                {% for p in productos %}   
                <tbody>
                    <tr>
                        {% if p.usuario_fk.username == user.username  %}
                        <td>{{ p.id  }}</td>
                        <td>{{ p.nombre_producto  }}</td>
                        <td>{{ p.origen_producto  }}</td>
                        <td>${{ p.nombre_producto.valor_producto  }}</td>
                        <td>{{ p.estado_fk  }}</td>
                        <td>{{ p.usuario_fk  }}</td>
                        <td>
                            
                            <a href="{%  url 'modify_product' p.id %}" class="btn btn-info btn-sm ">Modificar</a>


                            <a href="#" onclick="eliminarProducto({{ p.id }})  " class="btn btn-danger btn-sm ">Eliminar</a>

                            {% if p.estado_fk.desc_estado  == "Disponible" and p.usuario_fk.username != user.username %} <!-- PARA FK---->

                                  <a href="{%  url 'create_sale' p.id %}" class="btn btn-info btn-sm ">Crear venta</a>
                                  
                            {% endif  %}

                            
                            

                            {% if perms.app.delete_producto  %}
                            {% endif %}

                            {% endif %}    
                            
                        </td>
                    </tr>
                {% endfor %}    
                {% else %}
                <h3>No hay registros</h3>
                {% endif %}
                </tbody>

            </table>       
               
        </form>
</body>

{% endblock content %}