{% extends 'base/sidebar.html' %}

{%load static%} 

{% load permission_tags %}
{% block content %}

{%block css%} 
<link rel="stylesheet" href="{% static '/css/base.css'%}">
{%endblock%} 

<div class="container">
    <div class="col-md-6 col-md-offset-3 form-box">
        <h2>Lista de productos</h2>
        <hr width="50%">
        <form method="POST">
            <div class="form-group">
        
                <script>
                    function eliminarProducto(id){
                        Swal.fire({
                        "title": '¿Estás seguro?',
                        "text": "Una vez borrado no se podrá recuperar",
                        "icon": 'warning ',
                        "showCancelButton": true,
                        "confirmButtonColor": '#3085d6',
                        "cancelButtonColor": '#d33',
                        "cancelButtonText":"No, Cancelar", 
                        "confirmButtonText": 'Si, Eliminar',
                        "reverseButtons":true  
                
                        }).then(function(result) {
                            if (result.isConfirmed) {
                            window.location.href = "/delete_product/"+id+"/"
                        }
                        })
                
                    }
                
                </script>
    
    
                 
    
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>id</th>
                            <th>Nombre</th>
                            <th>Origen</th>
                            <th>Valor</th>
                            <th>Estado</th>
                            <th>Usuario</th>
                            <th>Opciones</th>
                        </tr>
                    </thead>
                    {% if productos  %}    
                    {% for p in productos %}   
                    <tbody>
                        <tr>
                            <td>{{ p.id  }}</td>
                            <td>{{ p.nombre_producto  }}</td>
                            <td>{{ p.origen_producto  }}</td>
                            <td>{{ p.nombre_producto.valor_producto  }}</td>
                            <td>{{ p.estado_fk  }}</td>
                            <td>{{ p.usuario_fk  }}</td>
                            <td>
                                {% load permission_tags %}
                                
                                <a href="{%  url 'modify_product' p.id %}" class="btn btn-info btn-sm ">Modificar</a>

                                {% if p.estado_fk.desc_estado  == "Disponible" and p.usuario_fk.username != user.username %} <!-- PARA FK---->

                                  <a href="{%  url 'create_sale' p.id %}" class="btn btn-info btn-sm ">Crear venta</a>
                                  
                                {% endif  %}



                                {% if user|has_role:'administrador'  %}
                        
                                <a href="#" onclick="eliminarProducto({{ p,id }})  " class="btn btn-danger btn-sm ">Eliminar</a>
                                {% endif %}
                                
                                
                            </td>
                        </tr>
                    {% endfor %}    
                    {% else %}
                    <h3>No hay registros</h3>
                    {% endif %}
                    </tbody>
    
                </table>              
                
    

      
            </div>
        </form>
    </div>
</div>

{% endblock content %}